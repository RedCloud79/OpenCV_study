# 열화상 카메라로 찍은 이미지를 구역별로 나눠 각 구역의 평균 온도를 파악
## 요구사항
##### 1. 7x5칸으로 나누기
##### 2. 격자로 선을 그어서 공간을 나누기 (반복문)
##### 3. 하나의 셀을 관심영역을로 쪼개서 관리할 수 있는 맵핑 row,col좌표로 접근해서 특정 셀에 접근
##### 4. 각 셀의 화소들 색상을 종합해서 평균값을 구함, 해당 평균값은 특정 기준으로 온도의 레벨(0~9)을 정한다.
##### 5. 255 -> level 9 255/10w
##### 6. 온도레벨을 해당 셀에 문자로 표시

```python
import cv2
import numpy as np

img = cv2.imread('./res/img1.jpg')
rows, cols = img.shape[0:2]
N = 7
K = 5
# rows : 290 세로, cols : 496 가로
x = 0; y = 0; w = int(cols/N); h = int(rows/K)

for i in range(N):
    for j in range(K):
        y = j * h
        x = i * w
        roi = img[y:y+h, x:x+w+10]
        cv2.rectangle(roi, (0,0), (h+12, w), (255, 255, 255))
        # HSV의 값
        gbHSV = cv2.cvtColor(roi, cv2.COLOR_BGR2HSV)
        dst = cv2.inRange(gbHSV, (130-10, 30, 30), (170+10, 255, 255))
        dst_data = np.mean(dst)
        Cn_HSV = 255-int(dst_data)

        # BGR의 값
        data = cv2.mean(roi)
        avg_data = int((data[0] + data[1] + data[2])/3)
        if avg_data < 120: avg_data = 0

        cv2.putText(roi, f"{i+1},{j+1}", (0,15), cv2.FONT_HERSHEY_SIMPLEX, 0.5, (255,255,255), 1, cv2.LINE_AA)
        cv2.putText(roi, f"{Cn_HSV}", (37,55), cv2.FONT_HERSHEY_SIMPLEX, 0.5, (0,255,0), 1, cv2.LINE_AA)
        print(f'index 0 : {roi}')

cv2.imshow('lines', img)
cv2.waitKey(0)
cv2.destroyAllWindows()
```
----------------------------------------------------------------------------------------
## 선을 만들어서 동작

```python
import cv2
import numpy as np

def createROI(src, cSize):
    cH = cellH
    if y+cellH >= rows:
        cH = rows%cellH

    cW = cellW
    if y+cellW >= cols:
        cW = cols%cellW
    # # 평균 구하기
    roi = np.zeros((cH, cW, 3), np.uint8)
    # # print('roi.shape: ', roi.shape[0:2])
    # # min(a1, a2) 두 값중에 작은값을 반환, 최대값 제한에 사용
    # # x1=x+100, x2= 50 min(x1, x2)일 경우 50이 출력
    # # max(a1, a2) 두 값중에 큰값을 반환, 최솟값 제한에 사용

    bTotal = 0

    for by in range(y, maxRows):
        for bx in range(x, maxCols):
            # print(f'({by},{bx})')
            colors = src[by, bx]
            fixelAvg = (colors[0] + colors[1] + colors[2]) / 3

            # bTotal[0] += bTotal[0] / 3
            # bTotal[1] += bTotal[1] / 3
            # bTotal[2] += bTotal[2] / 3

            bTotal += fixelAvg
            # bTotal += (colors[0] + colors[1] + colors[2])
            roi[by-y, bx-x] = colors

    mean = bTotal / ((cH * cW)*3)
    mean = (bTotal[0]+bTotal[1]+bTotal[2])  /3


src = cv2.imread('./res/img1.jpg')
rows, cols = src.shape[0:2]

src = cv2.resize(src, (cols*2, rows*2))
rows, cols = src.shape[0:2]

cellRows = 5
cellCols = 7

cellH = rows // cellRows
cellW = cols // cellCols

hsv = cv2.cvtColor(src, cv2.COLOR_BGR2HSV)
hsvMask = cv2.inRange(hsv, (-50, 0, 100), (130, 255, 255))
masked = cv2.copyTo(src, mask = hsvMask)

heatMap = cv2.cvtColor(masked, cv2.COLOR_BGR2GRAY)

dst=src.copy()

for y in range(0, rows, cellH):
    cv2.line(dst, (0,y), (cols, y), color=(255, 255, 255), thickness=1)

    for x in range(0, cols, cellW):

        pointText = f'({y},{x})'
        # print(pointText)
        cv2.line(dst, (x,0), (x, rows), color=(255, 255, 255), thickness=1)

        coordinate = f'({y//cellH},{x//cellW})'
        cv2.putText(dst, coordinate, (x+5,y+15), cv2.FONT_HERSHEY_COMPLEX_SMALL, 0.8, (0,255,0), 1)

        maxRows = min(y+cellH, rows)
        maxCols = min(x+cellW, cols)

        # cv2.imshow(coordinate, roi)
        # mean = np.mean(roi)
        roi = heatMap[y:maxRows , x:maxCols]
        # # np.mean = 모든 채널의 평균, cv2.mean = 각 채널의 평균
        mean = np.mean(roi)
        # mean = (mean[0] + mean[1] + mean[2]) /3
        # # mean[0], mean[1], mean[2]
        # print("mean: ", mean)
        cv2.putText(dst, f'{int(mean)}', (x+5,y+50), cv2.FONT_HERSHEY_COMPLEX_SMALL, 1.5, (0,255,0), 1)

        # TODO dst에 평균값을 문자로 표시

        pass

cv2.imshow('dst', dst)
cv2.waitKey(0)
cv2.destroyAllWindows()
```




























